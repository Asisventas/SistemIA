@page "/manual-sistema"
@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>Manual del Sistema - SistemIA</PageTitle>

<PageProtection Modulo="/manual-sistema" Permiso="VIEW">

<div class="container-fluid py-3 manual-sistema">
    <div class="row">
        <!-- Sidebar de navegación del manual -->
        <div class="col-md-3 col-lg-2">
            <div class="card manual-card shadow-sm sticky-top" style="top: 70px;">
                <div class="card-header manual-header-primary">
                    <i class="bi bi-book me-2"></i>Manual del Sistema
                </div>
                <div class="card-body p-0">
                    <nav class="nav flex-column nav-pills manual-nav">
                        <a class="nav-link @(seccionActiva == "inicio" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("inicio")'>
                            <i class="bi bi-house me-2"></i>Inicio
                        </a>
                        <a class="nav-link @(seccionActiva == "descuentos" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("descuentos")'>
                            <i class="bi bi-percent me-2"></i>Descuentos Automáticos
                        </a>
                        <a class="nav-link @(seccionActiva == "ventas" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("ventas")'>
                            <i class="bi bi-cart me-2"></i>Ventas
                        </a>
                        <a class="nav-link @(seccionActiva == "farmacia" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("farmacia")'>
                            <i class="bi bi-capsule me-2"></i>Modo Farmacia
                        </a>
                        <a class="nav-link @(seccionActiva == "sifen" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("sifen")'>
                            <i class="bi bi-file-earmark-code me-2"></i>SIFEN
                        </a>
                        <a class="nav-link @(seccionActiva == "permisos" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("permisos")'>
                            <i class="bi bi-shield-lock me-2"></i>Permisos
                        </a>
                        <a class="nav-link @(seccionActiva == "productos" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("productos")'>
                            <i class="bi bi-box-seam me-2"></i>Productos
                        </a>
                        <a class="nav-link @(seccionActiva == "compras" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("compras")'>
                            <i class="bi bi-bag me-2"></i>Compras
                        </a>
                        <a class="nav-link @(seccionActiva == "correo" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("correo")'>
                            <i class="bi bi-envelope-at me-2"></i>Correo Electrónico
                        </a>
                        <a class="nav-link @(seccionActiva == "asistente" ? "active" : "")" href="javascript:void(0)" @onclick='() => CambiarSeccion("asistente")'>
                            <i class="bi bi-robot me-2"></i>Asistente IA
                            <span class="badge bg-info ms-1" style="font-size: 8px;">Próx.</span>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        
        <!-- Contenido principal -->
        <div class="col-md-9 col-lg-10">
            @switch (seccionActiva)
            {
                case "inicio":
                    @RenderInicio()
                    break;
                case "descuentos":
                    @RenderDescuentos()
                    break;
                case "ventas":
                    @RenderVentas()
                    break;
                case "farmacia":
                    @RenderFarmacia()
                    break;
                case "sifen":
                    @RenderSifen()
                    break;
                case "permisos":
                    @RenderPermisos()
                    break;
                case "productos":
                    @RenderProductos()
                    break;
                case "compras":
                    @RenderCompras()
                    break;
                case "correo":
                    @RenderCorreo()
                    break;
                case "asistente":
                    @RenderAsistenteIA()
                    break;
            }
        </div>
    </div>
</div>

@code {
    private string seccionActiva = "inicio";
    
    private void CambiarSeccion(string seccion)
    {
        seccionActiva = seccion;
    }
    
    // ========== SECCIÓN: INICIO ==========
    private RenderFragment RenderInicio() => __builder =>
    {
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-house me-2"></i>Bienvenido al Manual del Sistema</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>SistemIA</strong> es un sistema de gestión empresarial integral con facturación electrónica SIFEN.
                </div>
                
                <h5><i class="bi bi-stars me-2"></i>Características Principales</h5>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <h6 class="card-title text-primary"><i class="bi bi-cart me-2"></i>Ventas</h6>
                                <p class="card-text small">Gestión completa de ventas con múltiples formas de pago, descuentos automáticos y generación de facturas electrónicas.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <h6 class="card-title text-success"><i class="bi bi-box-seam me-2"></i>Inventario</h6>
                                <p class="card-text small">Control de stock por depósito, alertas de stock mínimo, transferencias entre depósitos y ajustes de inventario.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <h6 class="card-title text-warning"><i class="bi bi-file-earmark-code me-2"></i>SIFEN</h6>
                                <p class="card-text small">Integración completa con el Sistema de Facturación Electrónica Nacional de Paraguay (SET).</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-info">
                            <div class="card-body">
                                <h6 class="card-title text-info"><i class="bi bi-capsule me-2"></i>Modo Farmacia</h6>
                                <p class="card-text small">Funcionalidades específicas para farmacias: precios ministerio, control de recetas y productos controlados.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-lightning me-2"></i>Accesos Rápidos</h5>
                <div class="d-flex flex-wrap gap-2 mt-3">
                    <a href="/configuracion-sistema" class="btn btn-outline-primary">
                        <i class="bi bi-sliders me-1"></i>Configuración General
                    </a>
                    <a href="/ventas" class="btn btn-outline-success">
                        <i class="bi bi-cart me-1"></i>Nueva Venta
                    </a>
                    <a href="/productos" class="btn btn-outline-info">
                        <i class="bi bi-box me-1"></i>Productos
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: DESCUENTOS AUTOMÁTICOS ==========
    private RenderFragment RenderDescuentos() => __builder =>
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="bi bi-percent me-2"></i>Sistema de Descuentos Automáticos</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-success">
                    <i class="bi bi-check-circle me-2"></i>
                    El sistema permite configurar descuentos automáticos que se aplican al momento de seleccionar un producto en ventas.
                </div>
                
                <!-- Jerarquía de Prioridad -->
                <h5 class="mt-4"><i class="bi bi-diagram-3 me-2"></i>Jerarquía de Prioridad</h5>
                <p>Los descuentos se aplican según el siguiente orden de prioridad:</p>
                
                <div class="row g-3 mt-2">
                    <div class="col-12">
                        <div class="d-flex align-items-stretch gap-2 flex-wrap">
                            <div class="card border-danger flex-fill" style="min-width: 180px;">
                                <div class="card-body text-center">
                                    <div class="badge bg-danger fs-5 mb-2">1°</div>
                                    <h6 class="card-title">Producto Específico</h6>
                                    <p class="card-text small text-muted">Descuento configurado directamente en la ficha del producto</p>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-right fs-4 text-muted"></i>
                            </div>
                            <div class="card border-warning flex-fill" style="min-width: 180px;">
                                <div class="card-body text-center">
                                    <div class="badge bg-warning text-dark fs-5 mb-2">2°</div>
                                    <h6 class="card-title">Por Marca</h6>
                                    <p class="card-text small text-muted">Descuento aplicado a todos los productos de una marca</p>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-right fs-4 text-muted"></i>
                            </div>
                            <div class="card border-info flex-fill" style="min-width: 180px;">
                                <div class="card-body text-center">
                                    <div class="badge bg-info fs-5 mb-2">3°</div>
                                    <h6 class="card-title">Por Clasificación</h6>
                                    <p class="card-text small text-muted">Descuento por categoría de productos</p>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-right fs-4 text-muted"></i>
                            </div>
                            <div class="card border-secondary flex-fill" style="min-width: 180px;">
                                <div class="card-body text-center">
                                    <div class="badge bg-secondary fs-5 mb-2">4°</div>
                                    <h6 class="card-title">General (TODOS)</h6>
                                    <p class="card-text small text-muted">Descuento aplicado a todos los productos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4" />
                
                <!-- Tutorial Paso a Paso -->
                <h5><i class="bi bi-journal-check me-2"></i>Tutorial: Configurar Descuentos por Categoría</h5>
                
                <div class="accordion mt-3" id="accordionDescuentos">
                    <!-- Paso 1 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#paso1">
                                <span class="badge bg-primary me-2">Paso 1</span>
                                Acceder a Configuración General
                            </button>
                        </h2>
                        <div id="paso1" class="accordion-collapse collapse show" data-bs-parent="#accordionDescuentos">
                            <div class="accordion-body">
                                <ol>
                                    <li>En el menú lateral, haga clic en <strong>Configuración</strong></li>
                                    <li>Seleccione <strong>Config. General</strong></li>
                                    <li>Busque la sección <strong>"Descuentos por Categoría"</strong></li>
                                </ol>
                                <div class="alert alert-light border mt-2">
                                    <i class="bi bi-lightbulb me-2 text-warning"></i>
                                    <strong>Tip:</strong> Asegúrese de tener habilitada la opción "Permitir Vender con Descuento" en la configuración de ventas.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Paso 2 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#paso2">
                                <span class="badge bg-primary me-2">Paso 2</span>
                                Agregar un Nuevo Descuento
                            </button>
                        </h2>
                        <div id="paso2" class="accordion-collapse collapse" data-bs-parent="#accordionDescuentos">
                            <div class="accordion-body">
                                <ol>
                                    <li>Haga clic en el botón <span class="btn btn-success btn-sm"><i class="bi bi-plus-lg"></i> Nuevo Descuento</span></li>
                                    <li>Se abrirá un formulario modal</li>
                                    <li>Complete los campos:
                                        <ul>
                                            <li><strong>Tipo:</strong> Seleccione TODOS, MARCA o CLASIFICACIÓN</li>
                                            <li><strong>Marca/Clasificación:</strong> Si eligió MARCA o CLASIFICACIÓN, seleccione cuál</li>
                                            <li><strong>Porcentaje:</strong> Ingrese el % de descuento (ej: 10 para 10%)</li>
                                            <li><strong>Prioridad:</strong> Número mayor = mayor prioridad entre descuentos del mismo tipo</li>
                                        </ul>
                                    </li>
                                </ol>
                                <div class="card bg-light mt-2">
                                    <div class="card-body">
                                        <strong>Ejemplo:</strong> Para aplicar 15% a todos los productos de la marca "Laboratorio ABC":
                                        <ul class="mb-0 mt-2">
                                            <li>Tipo: MARCA</li>
                                            <li>Marca: Laboratorio ABC</li>
                                            <li>Porcentaje: 15</li>
                                            <li>Prioridad: 1</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Paso 3 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#paso3">
                                <span class="badge bg-primary me-2">Paso 3</span>
                                Configurar Descuento por Producto (Opcional)
                            </button>
                        </h2>
                        <div id="paso3" class="accordion-collapse collapse" data-bs-parent="#accordionDescuentos">
                            <div class="accordion-body">
                                <p>Si desea que un producto tenga su propio descuento (ignorando la configuración general):</p>
                                <ol>
                                    <li>Vaya a <strong>Inventario → Productos</strong></li>
                                    <li>Busque y edite el producto</li>
                                    <li>En la sección de descuentos:
                                        <ul>
                                            <li>Marque <strong>"Usar descuento específico"</strong></li>
                                            <li>Ingrese el <strong>porcentaje de descuento automático</strong></li>
                                        </ul>
                                    </li>
                                    <li>Guarde los cambios</li>
                                </ol>
                                <div class="alert alert-warning mt-2">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    <strong>Importante:</strong> El descuento específico del producto tiene la máxima prioridad y anula cualquier configuración general.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Paso 4 -->
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#paso4">
                                <span class="badge bg-primary me-2">Paso 4</span>
                                Verificar en Ventas
                            </button>
                        </h2>
                        <div id="paso4" class="accordion-collapse collapse" data-bs-parent="#accordionDescuentos">
                            <div class="accordion-body">
                                <ol>
                                    <li>Abra una <strong>Nueva Venta</strong></li>
                                    <li>Busque y seleccione un producto con descuento configurado</li>
                                    <li>El descuento se aplicará <strong>automáticamente</strong>:
                                        <ul>
                                            <li>El campo de descuento mostrará el % aplicado</li>
                                            <li>El precio se calculará con el descuento incluido</li>
                                        </ul>
                                    </li>
                                    <li>Puede modificar el descuento manualmente si lo desea (respetando límites)</li>
                                </ol>
                                <div class="alert alert-success mt-2">
                                    <i class="bi bi-check2-circle me-2"></i>
                                    <strong>¡Listo!</strong> El descuento se aplica automáticamente al seleccionar el producto.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4" />
                
                <!-- Notas Importantes -->
                <h5><i class="bi bi-exclamation-diamond me-2"></i>Notas Importantes</h5>
                <ul class="list-group mt-2">
                    <li class="list-group-item">
                        <i class="bi bi-check text-success me-2"></i>
                        El descuento <strong>no puede reducir</strong> el precio por debajo del costo del producto
                    </li>
                    <li class="list-group-item">
                        <i class="bi bi-check text-success me-2"></i>
                        El descuento máximo está limitado por la configuración general o del producto
                    </li>
                    <li class="list-group-item">
                        <i class="bi bi-check text-success me-2"></i>
                        Los productos con <strong>"No permite descuento"</strong> no recibirán descuentos automáticos
                    </li>
                    <li class="list-group-item">
                        <i class="bi bi-check text-success me-2"></i>
                        Puede <strong>desactivar</strong> descuentos temporalmente sin eliminarlos (campo "Activo")
                    </li>
                </ul>
                
                <div class="mt-4">
                    <a href="/configuracion-sistema" class="btn btn-primary">
                        <i class="bi bi-gear me-1"></i>Ir a Configuración General
                    </a>
                    <a href="/productos" class="btn btn-outline-primary ms-2">
                        <i class="bi bi-box me-1"></i>Ir a Productos
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: VENTAS ==========
    private RenderFragment RenderVentas() => __builder =>
    {
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-cart me-2"></i>Módulo de Ventas</h4>
            </div>
            <div class="card-body">
                <h5><i class="bi bi-info-circle me-2"></i>Descripción General</h5>
                <p>El módulo de ventas permite registrar transacciones comerciales con soporte para:</p>
                <ul>
                    <li>Múltiples tipos de documento (Factura Electrónica, Ticket, Contado)</li>
                    <li>Descuentos automáticos por categoría, marca o producto</li>
                    <li>Múltiples formas de pago (Efectivo, Tarjeta, Transferencia, Cheque)</li>
                    <li>Integración con SIFEN (Facturación Electrónica)</li>
                    <li>Control de stock en tiempo real por depósito</li>
                    <li>Precios diferenciados por tipo de cliente</li>
                </ul>
                
                <hr />
                
                <h5><i class="bi bi-diagram-3 me-2"></i>Flujo de Venta</h5>
                <div class="d-flex align-items-center justify-content-center gap-2 flex-wrap my-4">
                    <span class="badge bg-secondary fs-6 p-2">1. Seleccionar Cliente</span>
                    <i class="bi bi-arrow-right text-muted"></i>
                    <span class="badge bg-info fs-6 p-2">2. Agregar Productos</span>
                    <i class="bi bi-arrow-right text-muted"></i>
                    <span class="badge bg-warning text-dark fs-6 p-2">3. Forma de Pago</span>
                    <i class="bi bi-arrow-right text-muted"></i>
                    <span class="badge bg-success fs-6 p-2">4. Confirmar/SIFEN</span>
                </div>
                
                <hr />
                
                <h5><i class="bi bi-keyboard me-2"></i>Atajos de Teclado</h5>
                <div class="table-responsive">
                    <table class="table table-sm table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 20%">Atajo</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td><kbd>F2</kbd></td><td><strong>Guardado rápido</strong> - Guarda la venta o confirma composición de caja</td></tr>
                            <tr><td><kbd>F4</kbd></td><td>Abrir búsqueda de cliente</td></tr>
                            <tr><td><kbd>F8</kbd></td><td>Guardar venta (confirmar)</td></tr>
                            <tr><td><kbd>F9</kbd></td><td>Abrir panel de formas de pago</td></tr>
                            <tr><td><kbd>Enter</kbd></td><td>Agregar producto seleccionado al detalle</td></tr>
                            <tr><td><kbd>Esc</kbd></td><td>Cerrar modal activo / Cancelar operación</td></tr>
                            <tr><td><kbd>+</kbd> / <kbd>-</kbd></td><td>Aumentar / Disminuir cantidad (en línea seleccionada)</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="alert alert-success mt-3">
                    <i class="bi bi-lightning me-2"></i>
                    <strong>Tip:</strong> Use <kbd>F2</kbd> para guardar rápidamente. Si está en la pantalla de composición de caja, F2 confirma la composición; si está en la venta, guarda directamente.
                </div>
                
                <hr />
                
                <h5><i class="bi bi-currency-dollar me-2"></i>Precios y Descuentos</h5>
                <p>El sistema aplica precios según la configuración del cliente:</p>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card border-primary h-100">
                            <div class="card-body">
                                <h6 class="text-primary"><i class="bi bi-person me-2"></i>Por Tipo de Cliente</h6>
                                <ul class="small mb-0">
                                    <li><strong>Minorista:</strong> Precio de venta regular</li>
                                    <li><strong>Mayorista:</strong> Precio mayorista del producto</li>
                                    <li><strong>Distribuidor:</strong> Precio distribuidor</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card border-success h-100">
                            <div class="card-body">
                                <h6 class="text-success"><i class="bi bi-tag me-2"></i>Por Lista de Precios</h6>
                                <p class="small mb-0">Si el cliente tiene una lista asignada, se aplica el factor de la lista sobre el precio base.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr />
                
                <h5><i class="bi bi-credit-card me-2"></i>Formas de Pago</h5>
                <div class="row g-2 mt-2">
                    <div class="col-6 col-md-3">
                        <div class="card text-center">
                            <div class="card-body py-2">
                                <i class="bi bi-cash-stack fs-4 text-success"></i>
                                <p class="small mb-0">Efectivo</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card text-center">
                            <div class="card-body py-2">
                                <i class="bi bi-credit-card fs-4 text-primary"></i>
                                <p class="small mb-0">Tarjeta</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card text-center">
                            <div class="card-body py-2">
                                <i class="bi bi-bank fs-4 text-info"></i>
                                <p class="small mb-0">Transferencia</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card text-center">
                            <div class="card-body py-2">
                                <i class="bi bi-file-text fs-4 text-warning"></i>
                                <p class="small mb-0">Cheque</p>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="small text-muted mt-2">Puede combinar múltiples formas de pago en una misma venta (pago mixto).</p>
                
                <hr />
                
                <h5><i class="bi bi-gear me-2"></i>Configuraciones Relacionadas</h5>
                <div class="list-group">
                    <div class="list-group-item">
                        <strong>Permitir Vender con Descuento:</strong> 
                        <span class="text-muted">Habilita/deshabilita la posibilidad de aplicar descuentos en ventas</span>
                    </div>
                    <div class="list-group-item">
                        <strong>Descuento Máximo:</strong> 
                        <span class="text-muted">Porcentaje máximo de descuento permitido por defecto</span>
                    </div>
                    <div class="list-group-item">
                        <strong>Modo Farmacia:</strong> 
                        <span class="text-muted">Activa funciones especiales para farmacias (precio ministerio, recetas)</span>
                    </div>
                    <div class="list-group-item">
                        <strong>Descontar Stock al Confirmar:</strong> 
                        <span class="text-muted">El stock se reduce automáticamente al confirmar la venta</span>
                    </div>
                </div>
                
                <div class="mt-4">
                    <a href="/ventas" class="btn btn-success">
                        <i class="bi bi-cart me-1"></i>Nueva Venta
                    </a>
                    <a href="/ventas/explorar" class="btn btn-outline-success ms-2">
                        <i class="bi bi-search me-1"></i>Explorador de Ventas
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: MODO FARMACIA ==========
    private RenderFragment RenderFarmacia() => __builder =>
    {
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0"><i class="bi bi-capsule me-2"></i>Modo Farmacia y Control de Lotes (FEFO)</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    El modo farmacia activa funcionalidades especiales para establecimientos farmacéuticos, incluyendo el control de <strong>lotes y vencimientos FEFO</strong>.
                </div>
                
                <h5><i class="bi bi-check2-square me-2"></i>Funcionalidades Principales</h5>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <h6><i class="bi bi-box-seam text-success me-2"></i>Control de Lotes FEFO</h6>
                                <p class="small"><strong>FEFO = First Expired, First Out</strong> (Primero en Vencer, Primero en Salir). El sistema selecciona automáticamente el lote más próximo a vencer.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <h6><i class="bi bi-exclamation-triangle text-warning me-2"></i>Alertas de Vencimiento</h6>
                                <p class="small">Monitoreo automático con alertas para productos próximos a vencer (30, 60, 90 días) y vencidos.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-tag text-primary me-2"></i>Precio Ministerio</h6>
                                <p class="small">Registro y control de precios regulados por el Ministerio de Salud. Se muestra en ticket y facturas.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-file-medical text-danger me-2"></i>Control de Recetas</h6>
                                <p class="small">Productos controlados requieren registro de receta médica con datos del médico y paciente.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr />
                
                <h5><i class="bi bi-toggle-on me-2"></i>Cómo Activar Control de Lotes en un Producto</h5>
                <ol>
                    <li>Vaya a <strong>Productos → Administrar Productos</strong></li>
                    <li>Edite el producto deseado</li>
                    <li>Active la opción <strong>"Controla Lote"</strong> ✅</li>
                    <li><strong>Guarde</strong> el producto</li>
                </ol>
                
                <div class="alert alert-success mt-3">
                    <i class="bi bi-magic me-2"></i>
                    <strong>Lotes Automáticos:</strong> Al activar "Controla Lote" por primera vez, el sistema crea automáticamente un lote inicial <code>STOCK-INICIAL</code> con el stock existente del producto. No necesita crear lotes manualmente para productos existentes.
                </div>
                
                <hr />
                
                <h5><i class="bi bi-diagram-3 me-2"></i>Flujo de Trabajo con Lotes</h5>
                <div class="row g-2">
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center p-2">
                                <i class="bi bi-bag-plus fs-3 text-primary"></i>
                                <p class="small mb-0"><strong>1. Compra</strong></p>
                                <p class="small mb-0 text-muted">Ingresar Lote y Vencimiento</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center p-2">
                                <i class="bi bi-sort-up fs-3 text-success"></i>
                                <p class="small mb-0"><strong>2. FEFO</strong></p>
                                <p class="small mb-0 text-muted">Sistema ordena por vencimiento</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card bg-light">
                            <div class="card-body text-center p-2">
                                <i class="bi bi-cart-check fs-3 text-info"></i>
                                <p class="small mb-0"><strong>3. Venta</strong></p>
                                <p class="small mb-0 text-muted">Descuenta del lote más antiguo</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr />
                
                <h5><i class="bi bi-info-circle me-2"></i>Información en Reportes</h5>
                <p class="small">Los informes detallados (Ventas, Compras, Productos) ahora incluyen columnas de <strong>Lote</strong> y <strong>Vencimiento</strong> para productos con control de lote habilitado.</p>
                
                <div class="mt-4">
                    <a href="/inventario/lotes" class="btn btn-info me-2">
                        <i class="bi bi-box-seam me-1"></i>Gestión de Lotes
                    </a>
                    <a href="/inventario/alertas-vencimiento" class="btn btn-warning me-2">
                        <i class="bi bi-exclamation-triangle me-1"></i>Alertas Vencimiento
                    </a>
                    <a href="/productos" class="btn btn-outline-info">
                        <i class="bi bi-box me-1"></i>Productos
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: SIFEN ==========
    private RenderFragment RenderSifen() => __builder =>
    {
        <div class="card shadow-sm">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-file-earmark-code me-2"></i>SIFEN - Facturación Electrónica</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    SIFEN es el Sistema Integrado de Facturación Electrónica Nacional de Paraguay (SET).
                </div>
                
                <h5><i class="bi bi-file-text me-2"></i>Tipos de Documentos Electrónicos</h5>
                <ul>
                    <li><strong>FE</strong> - Factura Electrónica</li>
                    <li><strong>NCE</strong> - Nota de Crédito Electrónica</li>
                    <li><strong>NDE</strong> - Nota de Débito Electrónica</li>
                    <li><strong>AFE</strong> - Autofactura Electrónica</li>
                    <li><strong>NRE</strong> - Nota de Remisión Electrónica</li>
                </ul>
                
                <hr />
                
                <h5><i class="bi bi-gear me-2"></i>Configuración Inicial</h5>
                <ol>
                    <li>Configurar datos de la Sociedad/Empresa</li>
                    <li>Cargar certificado digital (.pfx)</li>
                    <li>Configurar timbrado y puntos de emisión</li>
                    <li>Configurar actividades económicas</li>
                    <li>Realizar pruebas en ambiente de TEST</li>
                </ol>
                
                <hr />
                
                <h5><i class="bi bi-diagram-2 me-2"></i>Estados de Documentos</h5>
                <div class="d-flex gap-2 flex-wrap">
                    <span class="badge bg-secondary">PENDIENTE</span>
                    <span class="badge bg-info">ENVIADO</span>
                    <span class="badge bg-success">ACEPTADO</span>
                    <span class="badge bg-danger">RECHAZADO</span>
                    <span class="badge bg-warning text-dark">EN PROCESO</span>
                </div>
                
                <div class="mt-4">
                    <a href="/sifen-dashboard" class="btn btn-warning">
                        <i class="bi bi-speedometer2 me-1"></i>Dashboard SIFEN
                    </a>
                    <a href="/diagnostico-sifen" class="btn btn-outline-warning ms-2">
                        <i class="bi bi-tools me-1"></i>Diagnóstico SIFEN
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: PERMISOS ==========
    private RenderFragment RenderPermisos() => __builder =>
    {
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0"><i class="bi bi-shield-lock me-2"></i>Sistema de Permisos</h4>
            </div>
            <div class="card-body">
                <h5><i class="bi bi-people me-2"></i>Gestión de Accesos</h5>
                <p>El sistema cuenta con control de acceso basado en roles y permisos:</p>
                
                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <div class="card border-primary h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-person-badge fs-1 text-primary"></i>
                                <h6 class="mt-2">Usuarios</h6>
                                <p class="small">Cuentas individuales con credenciales únicas</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-success h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-people fs-1 text-success"></i>
                                <h6 class="mt-2">Roles</h6>
                                <p class="small">Agrupación de permisos (Admin, Vendedor, etc.)</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-warning h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-key fs-1 text-warning"></i>
                                <h6 class="mt-2">Permisos</h6>
                                <p class="small">Acciones específicas (Ver, Crear, Editar, Eliminar)</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr />
                
                <h5><i class="bi bi-lock me-2"></i>Tipos de Permisos</h5>
                <table class="table table-sm table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Permiso</th>
                            <th>Descripción</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><code>VIEW</code></td><td>Permite ver/consultar información</td></tr>
                        <tr><td><code>CREATE</code></td><td>Permite crear nuevos registros</td></tr>
                        <tr><td><code>EDIT</code></td><td>Permite modificar registros existentes</td></tr>
                        <tr><td><code>DELETE</code></td><td>Permite eliminar registros</td></tr>
                    </tbody>
                </table>
                
                <a href="/configuracion/usuarios" class="btn btn-danger mt-3">
                    <i class="bi bi-people me-1"></i>Gestionar Usuarios
                </a>
                <a href="/configuracion/roles" class="btn btn-outline-danger ms-2">
                    <i class="bi bi-person-gear me-1"></i>Gestionar Roles
                </a>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: PRODUCTOS ==========
    private RenderFragment RenderProductos() => __builder =>
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0"><i class="bi bi-box-seam me-2"></i>Gestión de Productos</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    El módulo de productos permite gestionar el catálogo completo de artículos, precios, stock y configuraciones especiales.
                </div>
                
                <h5><i class="bi bi-stars me-2"></i>Características Principales</h5>
                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <div class="card border-primary h-100">
                            <div class="card-body">
                                <h6 class="text-primary"><i class="bi bi-tags me-2"></i>Múltiples Precios</h6>
                                <p class="small">Configura diferentes precios: costo, venta, mayorista, distribuidor y precio ministerio (farmacias).</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-success h-100">
                            <div class="card-body">
                                <h6 class="text-success"><i class="bi bi-boxes me-2"></i>Control de Stock</h6>
                                <p class="small">Stock por depósito, stock mínimo, alertas automáticas y control de inventario en tiempo real.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-warning h-100">
                            <div class="card-body">
                                <h6 class="text-warning"><i class="bi bi-percent me-2"></i>Descuentos</h6>
                                <p class="small">Descuento específico por producto, descuento máximo permitido y control de rentabilidad.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-currency-dollar me-2"></i>Sistema de Precios</h5>
                <table class="table table-bordered table-sm">
                    <thead class="table-light">
                        <tr>
                            <th>Tipo de Precio</th>
                            <th>Descripción</th>
                            <th>Uso</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Precio Costo</strong></td>
                            <td>Costo de adquisición del producto</td>
                            <td>Cálculo de rentabilidad, no se muestra al cliente</td>
                        </tr>
                        <tr>
                            <td><strong>Precio Venta</strong></td>
                            <td>Precio regular al público</td>
                            <td>Ventas minoristas, clientes ocasionales</td>
                        </tr>
                        <tr>
                            <td><strong>Precio Mayorista</strong></td>
                            <td>Precio para compras en cantidad</td>
                            <td>Clientes con categoría "Mayorista"</td>
                        </tr>
                        <tr>
                            <td><strong>Precio Distribuidor</strong></td>
                            <td>Precio especial para distribuidores</td>
                            <td>Clientes con categoría "Distribuidor"</td>
                        </tr>
                        <tr>
                            <td><strong>Precio Ministerio</strong></td>
                            <td>Precio regulado (farmacias)</td>
                            <td>Se imprime en tickets cuando está activo el modo farmacia</td>
                        </tr>
                    </tbody>
                </table>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-person-lines-fill me-2"></i>Listas de Precios por Cliente</h5>
                <p>Además de los precios base, puede asignar listas de precios específicas a clientes:</p>
                <ol>
                    <li>Crear una <strong>Lista de Precios</strong> en Configuración → Listas de Precios</li>
                    <li>Definir el <strong>factor de ajuste</strong> (multiplicador sobre el precio base)</li>
                    <li>Asignar la lista al <strong>cliente</strong> en su ficha</li>
                    <li>En ventas, el precio se calculará automáticamente con el factor de la lista</li>
                </ol>
                
                <div class="alert alert-success">
                    <i class="bi bi-lightbulb me-2"></i>
                    <strong>Ejemplo:</strong> Lista "Preferencial" con factor 0.90 aplicará automáticamente 10% de descuento sobre precio venta.
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-sliders me-2"></i>Configuraciones del Producto</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="list-group">
                            <div class="list-group-item">
                                <strong>Permite Decimal</strong>
                                <p class="mb-0 small text-muted">Permite vender fracciones (ej: 1.5 kg)</p>
                            </div>
                            <div class="list-group-item">
                                <strong>Permite Descuento</strong>
                                <p class="mb-0 small text-muted">Habilita descuentos en este producto</p>
                            </div>
                            <div class="list-group-item">
                                <strong>Usar Descuento Específico</strong>
                                <p class="mb-0 small text-muted">Ignora descuentos por categoría/marca</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="list-group">
                            <div class="list-group-item">
                                <strong>Es Servicio</strong>
                                <p class="mb-0 small text-muted">No descuenta stock al vender</p>
                            </div>
                            <div class="list-group-item">
                                <strong>Requiere Receta</strong>
                                <p class="mb-0 small text-muted">Solicita datos de receta médica (modo farmacia)</p>
                            </div>
                            <div class="list-group-item">
                                <strong>Activo</strong>
                                <p class="mb-0 small text-muted">Permite vender el producto</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <a href="/productos" class="btn btn-info">
                        <i class="bi bi-box me-1"></i>Ir a Productos
                    </a>
                    <a href="/configuracion/listas-precios" class="btn btn-outline-info ms-2">
                        <i class="bi bi-tag me-1"></i>Listas de Precios
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: COMPRAS ==========
    private RenderFragment RenderCompras() => __builder =>
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0"><i class="bi bi-bag me-2"></i>Módulo de Compras</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-secondary">
                    <i class="bi bi-info-circle me-2"></i>
                    El módulo de compras permite registrar adquisiciones a proveedores, actualizar costos y controlar el inventario.
                </div>
                
                <h5><i class="bi bi-diagram-3 me-2"></i>Flujo de Compras</h5>
                <div class="d-flex align-items-center justify-content-center gap-2 flex-wrap my-4">
                    <span class="badge bg-secondary fs-6 p-2">1. Crear Compra</span>
                    <i class="bi bi-arrow-right text-muted"></i>
                    <span class="badge bg-info fs-6 p-2">2. Agregar Productos</span>
                    <i class="bi bi-arrow-right text-muted"></i>
                    <span class="badge bg-warning text-dark fs-6 p-2">3. Confirmar</span>
                    <i class="bi bi-arrow-right text-muted"></i>
                    <span class="badge bg-success fs-6 p-2">4. Stock Actualizado</span>
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-list-check me-2"></i>Características</h5>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-arrow-repeat text-primary me-2"></i>Actualización de Costos</h6>
                                <p class="small">Al confirmar la compra, puede actualizar automáticamente el precio de costo de los productos.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-boxes text-success me-2"></i>Entrada de Stock</h6>
                                <p class="small">El stock se incrementa automáticamente en el depósito seleccionado al confirmar.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-receipt text-info me-2"></i>Notas de Crédito</h6>
                                <p class="small">Genere notas de crédito de compras para devoluciones a proveedores.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-file-earmark-text text-warning me-2"></i>Comprobantes</h6>
                                <p class="small">Registre el número de factura del proveedor y datos del documento de compra.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-gear me-2"></i>Crear una Compra</h5>
                <ol>
                    <li>Ir a <strong>Compras → Nueva Compra</strong></li>
                    <li>Seleccionar el <strong>proveedor</strong></li>
                    <li>Ingresar <strong>número de factura</strong> del proveedor</li>
                    <li>Seleccionar el <strong>depósito</strong> de destino</li>
                    <li>Agregar los <strong>productos</strong> con cantidad y precio de compra</li>
                    <li><strong>Confirmar</strong> la compra para actualizar el stock</li>
                </ol>
                
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Una vez confirmada la compra, no puede ser modificada. Para corregir errores, utilice una Nota de Crédito de Compra.
                </div>
                
                <div class="mt-4">
                    <a href="/compras" class="btn btn-secondary">
                        <i class="bi bi-bag me-1"></i>Nueva Compra
                    </a>
                    <a href="/compras/explorar" class="btn btn-outline-secondary ms-2">
                        <i class="bi bi-search me-1"></i>Explorador de Compras
                    </a>
                </div>
            </div>
        </div>
    };
    
    // ========== SECCIÓN: CORREO ELECTRÓNICO ==========
    private RenderFragment RenderCorreo() => __builder =>
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-purple text-white" style="background-color: #6f42c1 !important;">
                <h4 class="mb-0"><i class="bi bi-envelope-at me-2"></i>Configuración de Correo Electrónico</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    Configure el servidor de correo para enviar notificaciones, informes automáticos y copias de facturas a clientes.
                </div>
                
                <h5><i class="bi bi-server me-2"></i>Configuración del Servidor SMTP</h5>
                <p>Para enviar correos, debe configurar los datos del servidor SMTP:</p>
                
                <table class="table table-bordered table-sm">
                    <thead class="table-light">
                        <tr>
                            <th>Campo</th>
                            <th>Descripción</th>
                            <th>Ejemplo</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Servidor SMTP</strong></td>
                            <td>Dirección del servidor de correo saliente</td>
                            <td>smtp.gmail.com, smtp.office365.com</td>
                        </tr>
                        <tr>
                            <td><strong>Puerto</strong></td>
                            <td>Puerto del servidor SMTP</td>
                            <td>587 (TLS), 465 (SSL), 25 (sin cifrado)</td>
                        </tr>
                        <tr>
                            <td><strong>Usar SSL/TLS</strong></td>
                            <td>Conexión segura</td>
                            <td>Recomendado: Activado</td>
                        </tr>
                        <tr>
                            <td><strong>Usuario</strong></td>
                            <td>Cuenta de correo para autenticación</td>
                            <td>sistema@miempresa.com</td>
                        </tr>
                        <tr>
                            <td><strong>Contraseña</strong></td>
                            <td>Contraseña o token de aplicación</td>
                            <td>Usar contraseña de aplicación si tiene 2FA</td>
                        </tr>
                    </tbody>
                </table>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-send me-2"></i>Datos del Remitente</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-person-badge text-primary me-2"></i>Nombre del Remitente</h6>
                                <p class="small mb-0">Nombre que aparecerá como remitente del correo (ej: "Mi Empresa S.A.")</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-envelope text-success me-2"></i>Correo Remitente</h6>
                                <p class="small mb-0">Dirección que aparece en el campo "De:" de los correos enviados</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6><i class="bi bi-reply text-info me-2"></i>Responder A</h6>
                                <p class="small mb-0">Dirección a la que llegarán las respuestas de los clientes</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-gear me-2"></i>Opciones de Envío Automático</h5>
                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <div class="card border-primary h-100">
                            <div class="card-body">
                                <h6 class="text-primary"><i class="bi bi-power me-2"></i>Enviar al Cierre del Sistema</h6>
                                <p class="small mb-0">Si está activado, al cerrar el sistema se enviarán automáticamente todos los informes configurados a los destinatarios.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-success h-100">
                            <div class="card-body">
                                <h6 class="text-success"><i class="bi bi-cash-stack me-2"></i>Enviar al Cierre de Caja</h6>
                                <p class="small mb-0">Cada destinatario puede elegir recibir informes automáticamente cuando se cierra un turno/caja.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card border-warning h-100">
                            <div class="card-body">
                                <h6 class="text-warning"><i class="bi bi-clock me-2"></i>Resumen Diario/Semanal/Mensual</h6>
                                <p class="small mb-0">Los destinatarios pueden elegir recibir resúmenes periódicos según su preferencia.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="my-4" />
                
                <h5><i class="bi bi-people me-2"></i>Destinatarios de Informes</h5>
                <p>Cada destinatario puede seleccionar qué informes desea recibir. Los informes disponibles son:</p>
                
                <div class="row g-3 mt-2">
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white py-2">
                                <i class="bi bi-cart me-2"></i>Ventas
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item small"><i class="bi bi-check2 text-success me-2"></i>Resumen de Cierre</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-success me-2"></i>Ventas Detallado</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-success me-2"></i>Ventas Agrupado</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-success me-2"></i>Ventas por Clasificación</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white py-2">
                                <i class="bi bi-bag me-2"></i>Compras y NC
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item small"><i class="bi bi-check2 text-primary me-2"></i>Compras Detallado</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-primary me-2"></i>Notas de Crédito</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-primary me-2"></i>NC Detallado</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-primary me-2"></i>NC de Compras</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-warning text-dark py-2">
                                <i class="bi bi-box-seam me-2"></i>Inventario
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item small"><i class="bi bi-check2 text-warning me-2"></i>Stock Valorizado</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-warning me-2"></i>Stock Detallado</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-warning me-2"></i>Movimientos de Stock</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-warning me-2"></i>Ajustes de Stock</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-warning me-2"></i>Alerta Stock Bajo</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-info text-white py-2">
                                <i class="bi bi-cash-coin me-2"></i>Financieros
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item small"><i class="bi bi-check2 text-info me-2"></i>Resumen de Caja</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-info me-2"></i>Cuentas por Cobrar</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-info me-2"></i>Cuentas por Pagar</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-danger text-white py-2">
                                <i class="bi bi-file-earmark-code me-2"></i>SIFEN y Sistema
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item small"><i class="bi bi-check2 text-danger me-2"></i>Resumen SIFEN</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-danger me-2"></i>Resumen Semanal</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-danger me-2"></i>Resumen Mensual</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-danger me-2"></i>Alertas Vencimientos</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-danger me-2"></i>Copia Facturas</li>
                                <li class="list-group-item small"><i class="bi bi-check2 text-danger me-2"></i>Resumen al Cierre</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100">
                            <div class="card-header bg-secondary text-white py-2">
                                <i class="bi bi-people me-2"></i>RRHH
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item small"><i class="bi bi-check2 text-secondary me-2"></i>Control de Asistencia</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="alert alert-primary mt-4">
                    <i class="bi bi-lightbulb me-2"></i>
                    <strong>Nuevo:</strong> Cada destinatario puede elegir la opción <strong>"Recibir TODOS los informes"</strong> para recibir automáticamente cualquier informe actual y futuro.
                </div>

                <hr class="my-4" />

                <h5><i class="bi bi-receipt me-2"></i>Envío Automático de Facturas a Clientes</h5>
                <div class="alert alert-success">
                    <i class="bi bi-envelope-paper me-2"></i>
                    En la ficha de cada <strong>Cliente</strong> puede activar la opción <strong>"Enviar Factura por Correo"</strong>. 
                    Si está activada, al confirmar una venta se enviará automáticamente el PDF de la factura al correo del cliente.
                </div>
                
                <hr class="my-4" />
                
                <h5><i class="bi bi-tools me-2"></i>Diagnóstico de Conexión</h5>
                <p>Utilice el panel de diagnóstico para verificar la configuración antes de enviar correos:</p>
                <ol>
                    <li><strong>Verificación de Configuración:</strong> Valida que todos los campos estén completos</li>
                    <li><strong>Resolución DNS:</strong> Verifica que el servidor SMTP sea accesible</li>
                    <li><strong>Conexión TCP:</strong> Prueba la conexión al puerto configurado</li>
                    <li><strong>Handshake TLS/SSL:</strong> Verifica el certificado de seguridad</li>
                    <li><strong>Autenticación:</strong> Valida las credenciales de acceso</li>
                    <li><strong>Envío de Prueba:</strong> Envía un correo de prueba al destinatario configurado</li>
                </ol>
                
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Configuración de Gmail:</strong> Si usa Gmail, debe crear una "Contraseña de aplicación" en <a href="https://myaccount.google.com/security" target="_blank">Seguridad de Google</a> → Verificación en 2 pasos → Contraseñas de aplicaciones. Las contraseñas normales no funcionan.
                </div>
                
                <div class="mt-4">
                    <a href="/configuracion/correo" class="btn btn-primary" style="background-color: #6f42c1; border-color: #6f42c1;">
                        <i class="bi bi-envelope-at me-1"></i>Configurar Correo
                    </a>
                </div>
            </div>
        </div>
    };

    // ========== SECCIÓN: ASISTENTE IA ==========
    private RenderFragment RenderAsistenteIA() => __builder =>
    {
        <div class="card shadow-sm mb-4">
            <div class="card-header text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h4 class="mb-0"><i class="bi bi-robot me-2"></i>Asistente IA - Próximamente</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-stars me-2"></i>
                    <strong>En Desarrollo:</strong> Estamos trabajando en un asistente con inteligencia artificial para ayudarle a usar el sistema de forma más eficiente.
                </div>
                
                <div class="text-center py-5">
                    <div style="font-size: 80px; color: #764ba2; opacity: 0.5;">
                        <i class="bi bi-robot"></i>
                    </div>
                    <h4 class="text-muted mt-3">Asistente Inteligente</h4>
                    <p class="text-muted">Un asistente que responderá sus preguntas sobre el sistema</p>
                </div>

                <h5><i class="bi bi-lightbulb me-2"></i>¿Qué podrá hacer el Asistente IA?</h5>
                <div class="row g-3 mt-2">
                    <div class="col-md-6">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <h6 class="text-primary"><i class="bi bi-question-circle me-2"></i>Responder Preguntas</h6>
                                <p class="small mb-0">Pregunte cómo realizar cualquier tarea del sistema y obtendrá instrucciones paso a paso.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <h6 class="text-success"><i class="bi bi-book me-2"></i>Guía Contextual</h6>
                                <p class="small mb-0">El asistente conocerá cada módulo del sistema y podrá guiarlo según donde se encuentre.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <h6 class="text-warning"><i class="bi bi-exclamation-triangle me-2"></i>Solución de Problemas</h6>
                                <p class="small mb-0">Ayuda para resolver errores comunes y problemas frecuentes en el uso del sistema.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-info">
                            <div class="card-body">
                                <h6 class="text-info"><i class="bi bi-lightning me-2"></i>Tips y Atajos</h6>
                                <p class="small mb-0">Descubra funciones ocultas, atajos de teclado y mejores prácticas para ser más productivo.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="my-4" />

                <h5><i class="bi bi-chat-dots me-2"></i>Ejemplos de Preguntas</h5>
                <div class="list-group mt-3">
                    <div class="list-group-item">
                        <i class="bi bi-chat-left-quote text-primary me-2"></i>
                        "¿Cómo configuro un descuento del 10% para todos los productos de una marca?"
                    </div>
                    <div class="list-group-item">
                        <i class="bi bi-chat-left-quote text-primary me-2"></i>
                        "¿Cómo envío la factura por correo al cliente?"
                    </div>
                    <div class="list-group-item">
                        <i class="bi bi-chat-left-quote text-primary me-2"></i>
                        "¿Por qué me sale error al enviar a SIFEN?"
                    </div>
                    <div class="list-group-item">
                        <i class="bi bi-chat-left-quote text-primary me-2"></i>
                        "¿Cómo hago una transferencia de stock entre depósitos?"
                    </div>
                    <div class="list-group-item">
                        <i class="bi bi-chat-left-quote text-primary me-2"></i>
                        "¿Cómo configuro los permisos de un usuario?"
                    </div>
                </div>

                <div class="alert alert-secondary mt-4">
                    <i class="bi bi-hourglass-split me-2"></i>
                    <strong>Disponibilidad:</strong> Esta funcionalidad estará disponible en una próxima actualización del sistema. Manténgase atento a las novedades.
                </div>
            </div>
        </div>
    };
}

<style>
    /* ========== ESTILOS MANUAL DEL SISTEMA - COMPATIBLE CON TEMAS ========== */
    
    .manual-sistema {
        color: var(--text-primary);
    }
    
    /* Cards principales */
    .manual-sistema .manual-card,
    .manual-sistema .card {
        background-color: var(--bg-surface);
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    
    .manual-sistema .card-body {
        background-color: var(--bg-surface);
        color: var(--text-primary);
    }
    
    .manual-sistema .card-text {
        color: var(--text-secondary);
    }
    
    /* Headers de cards con colores primarios */
    .manual-sistema .manual-header-primary {
        background-color: var(--bs-primary);
        color: white;
        border-bottom: 1px solid var(--border-color);
    }
    
    .manual-sistema .card-header {
        background-color: var(--bg-surface-alt, var(--bg-surface));
        color: var(--text-primary);
        border-bottom: 1px solid var(--border-color);
    }
    
    /* Navegación del sidebar */
    .manual-sistema .manual-nav .nav-link {
        color: var(--text-primary);
        border-radius: 0;
        padding: 0.75rem 1rem;
        border-left: 3px solid transparent;
        transition: all 0.2s ease;
    }
    
    .manual-sistema .manual-nav .nav-link:hover {
        background-color: var(--bg-hover);
        color: var(--text-primary);
        border-left-color: var(--bs-primary);
    }
    
    .manual-sistema .manual-nav .nav-link.active {
        background-color: var(--bs-primary);
        color: white;
        border-left-color: var(--bs-primary);
    }
    
    /* Alertas */
    .manual-sistema .alert-info {
        background-color: rgba(var(--bs-info-rgb), 0.15);
        border-color: rgba(var(--bs-info-rgb), 0.3);
        color: var(--text-primary);
    }
    
    .manual-sistema .alert-success {
        background-color: rgba(var(--bs-success-rgb), 0.15);
        border-color: rgba(var(--bs-success-rgb), 0.3);
        color: var(--text-primary);
    }
    
    .manual-sistema .alert-warning {
        background-color: rgba(var(--bs-warning-rgb), 0.15);
        border-color: rgba(var(--bs-warning-rgb), 0.3);
        color: var(--text-primary);
    }
    
    .manual-sistema .alert-light {
        background-color: var(--bg-surface-alt, var(--bg-surface));
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    
    /* Tablas */
    .manual-sistema .table {
        color: var(--text-primary);
        border-color: var(--border-color);
    }
    
    .manual-sistema .table-light,
    .manual-sistema .table thead {
        background-color: var(--bg-surface-alt, var(--bg-hover));
        color: var(--text-primary);
    }
    
    .manual-sistema .table th,
    .manual-sistema .table td {
        border-color: var(--border-color);
        background-color: var(--bg-surface);
        color: var(--text-primary);
    }
    
    .manual-sistema .table-bordered {
        border-color: var(--border-color);
    }
    
    /* Accordion */
    .manual-sistema .accordion-item {
        background-color: var(--bg-surface);
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    
    .manual-sistema .accordion-button {
        background-color: var(--bg-surface);
        color: var(--text-primary);
        border-color: var(--border-color);
    }
    
    .manual-sistema .accordion-button:not(.collapsed) {
        background-color: var(--bg-hover);
        color: var(--text-primary);
    }
    
    .manual-sistema .accordion-button::after {
        filter: var(--icon-filter, none);
    }
    
    .manual-sistema .accordion-body {
        background-color: var(--bg-surface);
        color: var(--text-primary);
    }
    
    /* List groups */
    .manual-sistema .list-group-item {
        background-color: var(--bg-surface);
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    
    /* Cards con bordes de colores */
    .manual-sistema .card.border-primary,
    .manual-sistema .card.border-success,
    .manual-sistema .card.border-warning,
    .manual-sistema .card.border-info,
    .manual-sistema .card.border-danger,
    .manual-sistema .card.border-secondary {
        background-color: var(--bg-surface);
    }
    
    .manual-sistema .card.border-primary .card-body,
    .manual-sistema .card.border-success .card-body,
    .manual-sistema .card.border-warning .card-body,
    .manual-sistema .card.border-info .card-body,
    .manual-sistema .card.border-danger .card-body,
    .manual-sistema .card.border-secondary .card-body {
        background-color: var(--bg-surface);
    }
    
    /* Cards de prioridad en descuentos */
    .manual-sistema .card h6.card-title {
        color: inherit;
    }
    
    /* Separadores */
    .manual-sistema hr {
        border-color: var(--border-color);
        opacity: 0.5;
    }
    
    /* Código */
    .manual-sistema code {
        background-color: var(--bg-hover);
        color: var(--text-primary);
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
    }
    
    /* Teclado (kbd) */
    .manual-sistema kbd {
        background-color: var(--bg-surface-alt, #333);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }
    
    /* Texto muted */
    .manual-sistema .text-muted {
        color: var(--text-secondary) !important;
    }
    
    /* Cards de características en inicio */
    .manual-sistema .card.bg-light {
        background-color: var(--bg-surface-alt, var(--bg-hover)) !important;
        color: var(--text-primary);
    }
    
    /* Headers de sección */
    .manual-sistema h5 {
        color: var(--text-primary);
    }
    
    /* Submenu section header */
    .manual-sistema .submenu-section-header {
        color: var(--text-secondary);
    }
</style>

</PageProtection>

@page "/sistema/conversaciones-ia"
@using Microsoft.EntityFrameworkCore
@using SistemIA.Models
@inject IDbContextFactory<AppDbContext> DbFactory

<PageTitle>Conversaciones IA - SistemIA</PageTitle>

<SaProtection TituloPagina="Historial de Conversaciones IA" UrlRetorno="/">

<h3><i class="bi bi-robot text-primary me-2"></i>Conversaciones IA</h3>

<div class="card">
<table class="table table-hover mb-0">
<thead class="table-light"><tr><th>ID</th><th>Fecha</th><th>Modelo</th><th>Titulo</th><th>Resumen</th></tr></thead>
<tbody>
@foreach (var item in lista)
{
<tr>
<td>@item.IdConversacionIA</td>
<td>@item.FechaInicio.ToString("dd/MM/yyyy HH:mm")</td>
<td>@item.ModeloIA</td>
<td>@item.Titulo</td>
<td>@item.ResumenEjecutivo</td>
</tr>
}
</tbody>
</table>
</div>

</SaProtection>

@code {
List<ConversacionIAHistorial> lista = new();

protected override async Task OnInitializedAsync()
{
await using var ctx = await DbFactory.CreateDbContextAsync();
lista = await ctx.ConversacionesIAHistorial.OrderByDescending(x => x.FechaInicio).Take(50).ToListAsync();
}
}